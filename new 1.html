<html>
<head>
    <link href="css/style.css" rel="stylesheet">
</head>
<body>
    <div class="wrapper">
<!--	   <div class="crd" id="1"></div>-->
<!--	   <div class="crd" id="2" style="left: 60px"></div>-->
<!--	   <div class="crd" id="3" style="left: 120px"></div>-->
<!--	   <div class="crd" style="left: 180px"></div>-->
<!--	   <div class="crd" style="left: 240px"></div>-->
    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<!--    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>-->
    <script src="https://cdn.rawgit.com/nnattawat/flip/master/dist/jquery.flip.min.js"></script>
    <script>
            $(document).ready(function(){
                
                const cardWidth = 60;
                const cardHeight = 100;
                
                jQuery.fn.flip = function(degrees, NeedRotate = false) {
                    //$(this).css({'backface-visibility' : 'hidden'});
                    var val;
                    var rotateDegr = Math.floor((Math.random() * 10) - 5); //range -5 ... 5
                    
                    if(NeedRotate)
                        val = 'rotate('+ rotateDegr +'deg) rotateY('+ degrees +'deg)';
                    else
                        val = 'rotate(0deg) rotateY('+ degrees +'deg)';
                    
                    $(this).css({'transform' : val});
                    $(this).css({'transition' : 'all 0.5s ease-out'});
                    return $(this);
                };
                
                jQuery.fn.rotate = function(rotate=true) {
                    var degrees = Math.floor((Math.random() * 10) - 5); //range -5 ... 5
                    if(rotate)
                        $(this).css({'transform' : 'rotate('+ degrees +'deg)'});
                    else
                        $(this).css({'transform' : 'rotate(0deg)'});
                    
                    return $(this);
                };
                
                // GLOBAL
                var InHandArr = new Array();
                var onTableArr = new Array();
                
                
                var w = $(".wrapper").css("width");
                var w2 = parseInt(w);
                w2 /= 2;
                w2 -= cardWidth/2;
                var wCenter = w2;

                var h = $(".wrapper").css("height");
                var h2 = parseInt(h);
                h = h2 - cardHeight - 10;
                h2 /= 2;
                h2 -= cardHeight/2;
                  
                var d = $(".wrapper");
                for(var i = 0; i < 36; i++){
                    d.append('<div class="crd" id='+ parseInt(i+1) +'>'+ i +'</div>');
                }
                
                var tArr = d.children(".crd");
                for(var i = 0; i < tArr.length; i++){
                    $(tArr[i]).rotate();
                }
                
                // END GLOBAL
                
                
            
                $(window).resize(function(){
                    w = $(".wrapper").css("width");
                    w2 = parseInt(w);
                    w2 /= 2;
                    w2 -= cardWidth/2;
                    wCenter = w2;
                    h = $(".wrapper").css("height");
                    h2 = parseInt(h);
                    h = h2 - cardHeight - 10;
                    h2 /= 2;
                    h2 -= cardHeight/2;
                    var t = w2 - (cardWidth/2 * (InHandArr.length-1));
                    if(InHandArr.length > 0) {
                        for(var i = 0; i < InHandArr.length; i++){
                            $(InHandArr[i]).css("left", t);
                            $(InHandArr[i]).css("top", h);
                            //$(InHandArr[i]).animate({left: t, top: h}, "slow");
                            t += cardWidth;
                        }
                        w2 = t - cardWidth;
                    }
                }); 
                
                $(".crd").click(function(){
                    
                    
                    var addToHand = true;
                    var PosInHand = 0;
                    
                    for(var i = 0; i < InHandArr.length; i++) {
                        if(InHandArr[i] === this) {
                            addToHand = false;
                            PosInHand = i;
                            break;
                        }
                    }
                    if(addToHand){
                        InHandArr.push(this);
                        w2 += cardWidth/2;
                        $(this).animate({left: w2, top: h}, "slow", function(){ 
                                            $(this).flip(-180, false);
                                        });
                        if(InHandArr.length > 0) {
                            for(var i = 0; i < InHandArr.length-1; i++){
                                $(InHandArr[i]).animate({left: "-=30px"}, "slow");
                            }
                        }
                    } 
                    else {  // to table                      
                        $(this).animate({left: wCenter, top: h2}, "slow", function(){ 
                                            $(this).rotate(); //$(this).flip(180, true); 
                                            
                                        });
                        if(InHandArr.length > 0) {
                            for(var i = 0; i < InHandArr.length; i++){
                                if(i <= PosInHand)
                                    $(InHandArr[i]).animate({left: "+=30px"}, "slow", function(){});
                                else
                                    $(InHandArr[i]).animate({left: "-=30px"}, "slow", function(){});
                            }
                        }
                        InHandArr.splice(PosInHand,1);
                        PosInHand = 0;
                        w2 -= cardWidth/2;
                    }
                });
            });
    </script>
</body>
</html>