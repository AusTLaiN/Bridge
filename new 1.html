<html>
<head>
    <link href="css/style.css" rel="stylesheet">
</head>
<body>
    <div class="wrapper">
<!--	   <div class="crd" id="1"></div>-->
<!--	   <div class="crd" id="2" style="left: 60px"></div>-->
<!--	   <div class="crd" id="3" style="left: 120px"></div>-->
<!--	   <div class="crd" style="left: 180px"></div>-->
<!--	   <div class="crd" style="left: 240px"></div>-->
    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<!--    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>-->
    <script src="https://cdn.rawgit.com/nnattawat/flip/master/dist/jquery.flip.min.js"></script>
    <script>
            $(document).ready(function(){
                
                const cardWidth = 60;
                const cardHeight = 100;
                
                jQuery.fn.flip = function(degrees, NeedRotate = false) {
                    //$(this).css({'backface-visibility' : 'hidden'});
                    var val;
                    var rotateDegr = Math.floor((Math.random() * 10) - 5); //range -5 ... 5
                    
                    if(NeedRotate)
                        val = 'rotate('+ rotateDegr +'deg) rotateY('+ degrees +'deg)';
                    else
                        val = 'rotate(0deg) rotateY('+ degrees +'deg)';
                    
                    $(this).css({'transform' : val});
                    $(this).css({'transition' : 'transform 0.5s ease-out'});

                    $(".crd").removeAttr('data-animated');
                    return $(this);
                };
                
                jQuery.fn.rotate = function(rotate=true) {
                    var degrees = Math.floor((Math.random() * 10) - 5); //range -5 ... 5
                    var t = $(this).css('transform');
                    if(rotate)
                        $(this).css({'transform' : 'rotate('+ degrees +'deg) ' + t});
                    else
                        $(this).css({'transform' : 'rotate(0deg)'});
                    
                    return $(this);
                };
                
                // GLOBAL
                var InHandArr = new Array();
                var onTableArr = new Array();
                
                
                var w = $(document).width();
                var w2 = parseInt(w);
                w2 /= 2;
                w2 -= cardWidth/2;
                var wCenter = w2;

                var h = $(document).height();
                var h2 = parseInt(h);
                h = h2 - cardHeight - 10;
                h2 /= 2;
                h2 -= cardHeight/2;
               
                // initDeck
                var d = $(".wrapper");
                for(var i = 0; i < 36; i++){
                    d.append('<div class="crd" id='+ parseInt(i+1) +'>'+ i +'</div>');
                }
                
                var tArr = d.children(".crd");
                for(var i = 0; i < tArr.length; i++){
                    $(tArr[i]).rotate();
                }
                
                // END GLOBAL
                
                
                // onResize
                $(window).resize(function(){
                    w = $(document).width();
                    w2 = parseInt(w);
                    w2 /= 2;
                    w2 -= cardWidth/2;
                    wCenter = w2;
                    h = $(document).height();
                    h2 = parseInt(h);
                    h = h2 - cardHeight - 10;
                    h2 /= 2;
                    h2 -= cardHeight/2;
                    var t = w2 - (cardWidth/2 * (InHandArr.length-1));
                    if(InHandArr.length > 0) {
                        for(var i = 0; i < InHandArr.length; i++){
                            $(InHandArr[i]).css({"left": t + 'px'});
                            $(InHandArr[i]).css({"top": h + 'px'});
                            //$(InHandArr[i]).animate({left: t, top: h}, "slow");
                            t += cardWidth;
                        }
                        w2 = t - cardWidth;
                    }
                }); 
                
                // onCardClick
                $(".crd").click(function(){
                    if ($(".crd").attr('data-animated')) {
                        return;
                    };
                    
                    $(".crd").attr('data-animated', 'yes');
                    
                    var moveToHand = true;
                    var posInHand = 0;
                    
                    for(var i = 0; i < InHandArr.length; i++) {
                        if(InHandArr[i] === this) {
                            moveToHand = false;
                            posInHand = i;
                            break;
                        }
                    }
                    if(moveToHand){ // move to player
                        InHandArr.push(this);
                        w2 += cardWidth/2;
                        $(this).animate({left: w2, top: h}, "slow", function(){ 
                                            $(this).flip(-180, false);
                                        });
                        if(InHandArr.length > 0) {
                            for(var i = 0; i < InHandArr.length-1; i++){
                                $(InHandArr[i]).animate({left: "-=30px"}, "medium");
                            }
                        }
                    } 
                    else {  // move to table     
                        w2 -= cardWidth/2;
                        
                        $(this).animate({top: h-30}, "fast", function(){
                                            $(this).rotate();
                                            $(this).animate({left: wCenter, top: h2}, "slow", function(){
                                                $(".crd").removeAttr('data-animated');
                                            });
                                        });
                        
                        if(InHandArr.length > 0) {
                            for(var i = 0; i < InHandArr.length; i++){
                                if(i <= posInHand) {
                                    $(InHandArr[i]).animate({"left": "+=30px"}, "slow", function(){});
                                }
                                else {

                                    $(InHandArr[i]).animate({"left": "-=30px"}, "slow", function(){});
                                }
                            }
                        }
                        InHandArr.splice(posInHand,1);
                        posInHand = 0;
                    }
                });
            });
    </script>
</body>
</html>